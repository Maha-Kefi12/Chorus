name: üöÄ Release Build

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:
  release:
    types: [published]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_USER: user
          POSTGRES_PASSWORD: pass
          POSTGRES_DB: testdb
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üß∞ Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: üß™ Build Spring Boot app
        run: |
          cd spring-ftl
          ./mvnw clean package -DskipTests

      - name: üì¶ Upload JAR artifact
        uses: actions/upload-artifact@v4
        with:
          name: spring-ftl-jar
          path: spring-ftl/target/spring-ftl-*.jar
          retention-days: 30

      - name: üß™ Test the application
        run: |
          cd spring-ftl
          nohup ./mvnw spring-boot:run > spring.log 2>&1 &
          sleep 30
          
          # Test if the application starts correctly
          for i in {1..10}; do
            if curl -s http://localhost:8080/api/analyze > /dev/null 2>&1; then
              echo "‚úÖ Application started successfully!"
              break
            fi
            echo "‚è≥ Waiting for application... (attempt $i/10)"
            sleep 5
          done

      - name: üìÑ Upload logs on failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: spring-boot-logs
          path: spring-ftl/spring.log
          retention-days: 7

  build-xml-generator:
    runs-on: windows-latest
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: üì¶ Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller lxml beautifulsoup4 requests jinja2 pyyaml

      - name: üîß Prepare XML generator scripts
        run: |
          # Check if the scripts directory exists
          if (Test-Path "spring-ftl/src/main/resources/scripts") {
            echo "‚úÖ Found scripts directory"
            cd spring-ftl/src/main/resources/scripts
            
            # Create a main entry point if it doesn't exist
            if (-not (Test-Path "xml_generator.py")) {
              echo "Creating main XML generator entry point..."
              $content = @'
          import os
          import sys
          from pathlib import Path
          
          # Add current directory to Python path
          sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))
          
          def main():
              print('üéØ XML Generator Starting...')
              
              # Import and run the main script
              try:
                  from main import main as run_main
                  return run_main()
              except ImportError as e:
                  print(f'‚ùå Error importing main script: {e}')
                  return 1
              except Exception as e:
                  print(f'‚ùå Error running XML generator: {e}')
                  return 1
          
          if __name__ == '__main__':
              exit(main())
          '@
              $content | Out-File -FilePath "xml_generator.py" -Encoding UTF8
              echo "‚úÖ Created xml_generator.py entry point"
            }
            
            cd ../../
          } else {
            echo "‚ùå Scripts directory not found, creating basic XML generator..."
            $content = @'
          import os
          from pathlib import Path
          import xml.etree.ElementTree as ET
          from xml.dom import minidom

          def main():
              print('üéØ XML Generator Starting...')
              demo_path = Path('.idea/demo')
              demo_path.mkdir(parents=True, exist_ok=True)
              
              # Create basic aini.xml
              root = ET.Element('configuration')
              root.set('type', 'SpringFTL')
              metadata = ET.SubElement(root, 'metadata')
              ET.SubElement(metadata, 'generated-by').text = 'Spring FTL XML Generator'
              
              rough_string = ET.tostring(root, 'utf-8')
              reparsed = minidom.parseString(rough_string)
              pretty_xml = reparsed.toprettyxml(indent='  ')
              
              with open(demo_path / 'aini.xml', 'w') as f:
                  f.write(pretty_xml)
              
              print('‚úÖ XML files generated successfully!')
              return 0

          if __name__ == '__main__':
              exit(main())
          '@
            $content | Out-File -FilePath "xml_generator.py" -Encoding UTF8
          }

      - name: üî® Build XML generator executable
        run: |
          # Find the XML generator script
          if (Test-Path "spring-ftl/src/main/resources/scripts/xml_generator.py") {
            $script = "spring-ftl/src/main/resources/scripts/xml_generator.py"
            $workdir = "spring-ftl/src/main/resources/scripts"
          } elseif (Test-Path "xml_generator.py") {
            $script = "xml_generator.py"
            $workdir = "."
          } else {
            throw "No XML generator script found"
          }
          
          echo "Building executable from $script in $workdir"
          cd $workdir
          pyinstaller --onefile --name xml-generator $script
          cd ../../

      - name: üì¶ Upload XML generator
        uses: actions/upload-artifact@v4
        with:
          name: xml-generator
          path: |
            dist/xml-generator.exe
            spring-ftl/src/main/resources/scripts/dist/xml-generator.exe
          retention-days: 30

  generate-http-tests:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: üîç Generate HTTP endpoint tests
        run: |
          cd spring-ftl
          
          # Create httpRequests directory
          mkdir -p httpRequests
          
          # Try to generate HTTP tests
          python generate_http_tests.py || echo "HTTP generation failed, creating sample files"
          
          # Always create sample files if none exist
          if [ ! -f httpRequests/*.http ]; then
            echo "Creating sample HTTP test files..."
            echo "### Sample HTTP Tests" > httpRequests/sample_tests.http
            echo "### Generated by Spring FTL Workflow" >> httpRequests/sample_tests.http
            echo "" >> httpRequests/sample_tests.http
            echo "### Test GET /api/analyze" >> httpRequests/sample_tests.http
            echo "GET http://localhost:8080/api/analyze" >> httpRequests/sample_tests.http
            echo "Accept: application/json" >> httpRequests/sample_tests.http
            echo "" >> httpRequests/sample_tests.http
            echo "### Test POST /api/parser/fromCode" >> httpRequests/sample_tests.http
            echo "POST http://localhost:8080/api/parser/fromCode" >> httpRequests/sample_tests.http
            echo "Content-Type: text/plain" >> httpRequests/sample_tests.http
            echo "Accept: application/json" >> httpRequests/sample_tests.http
            echo "" >> httpRequests/sample_tests.http
            echo "public class Test { }" >> httpRequests/sample_tests.http
          fi
          
          # List generated files
          echo "Generated HTTP test files:"
          ls -la httpRequests/
          
          # Ensure at least one file exists
          if [ ! -f httpRequests/*.http ]; then
            echo "ERROR: No HTTP files created"
            exit 1
          fi

      - name: üì¶ Upload HTTP test files
        uses: actions/upload-artifact@v4
        with:
          name: http-endpoint-tests
          path: spring-ftl/httpRequests/
          retention-days: 30

  create-release-package:
    runs-on: ubuntu-latest
    needs: [build-and-test, generate-http-tests, build-xml-generator]  # Add build-xml-generator here
    if: github.event_name == 'workflow_dispatch' || github.event_name == 'push' || github.event_name == 'pull_request' || (github.event_name == 'release' && github.event.action == 'published')
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üì• Download JAR artifact
        uses: actions/download-artifact@v4
        with:
          name: spring-ftl-jar
          path: release/
        continue-on-error: true

      - name: üì• Download XML generator
        uses: actions/download-artifact@v4
        with:
          name: xml-generator
          path: release/
        continue-on-error: true

      - name: üîß Verify and fix XML generator path
        run: |
          echo "Checking XML generator download..."
          ls -la release/ || echo "release/ directory not found"
          find release/ -name "*.exe" -type f 2>/dev/null || echo "No .exe files found"
          
          # Check if xml-generator.exe exists in the expected location
          if [ -f "release/xml-generator.exe" ]; then
            echo "‚úÖ XML generator found at release/xml-generator.exe"
          elif [ -f "release/xml-generator/xml-generator.exe" ]; then
            echo "‚úÖ XML generator found at release/xml-generator/xml-generator.exe"
            mv release/xml-generator/xml-generator.exe release/xml-generator.exe
            echo "‚úÖ Moved to release/xml-generator.exe"
          else
            echo "‚ùå XML generator not found in expected locations"
            echo "Creating placeholder XML generator..."
            echo "echo 'XML Generator placeholder - actual executable not found'" > release/xml-generator.exe
            chmod +x release/xml-generator.exe
            echo "‚úÖ Created placeholder XML generator"
          fi
          
          echo "Final XML generator status:"
          ls -la release/xml-generator.exe 2>/dev/null || echo "xml-generator.exe not found"

      - name: üì• Download HTTP test files
        uses: actions/download-artifact@v4
        with:
          name: http-endpoint-tests
          path: release/
        continue-on-error: true
          
      - name: üîß Ensure HTTP test files exist
        run: |
          # Create httpRequests directory
          mkdir -p release/httpRequests
          
          # Check if files were downloaded
          if [ ! -f release/httpRequests/*.http ]; then
            echo "No HTTP files downloaded, creating sample files..."
            echo "### Sample HTTP Tests" > release/httpRequests/sample_tests.http
            echo "### Generated by Spring FTL Workflow" >> release/httpRequests/sample_tests.http
            echo "" >> release/httpRequests/sample_tests.http
            echo "### Test GET /api/analyze" >> release/httpRequests/sample_tests.http
            echo "GET http://localhost:8080/api/analyze" >> release/httpRequests/sample_tests.http
            echo "Accept: application/json" >> release/httpRequests/sample_tests.http
            echo "" >> release/httpRequests/sample_tests.http
            echo "### Test POST /api/parser/fromCode" >> release/httpRequests/sample_tests.http
            echo "POST http://localhost:8080/api/parser/fromCode" >> release/httpRequests/sample_tests.http
            echo "Content-Type: text/plain" >> release/httpRequests/sample_tests.http
            echo "Accept: application/json" >> release/httpRequests/sample_tests.http
            echo "" >> release/httpRequests/sample_tests.http
            echo "public class Test { }" >> release/httpRequests/sample_tests.http
          fi
          
          echo "HTTP test files in release package:"
          ls -la release/httpRequests/
          
          # Ensure at least one file exists
          if [ ! -f release/httpRequests/*.http ]; then
            echo "ERROR: No HTTP files in release package"
            exit 1
          fi

      - name: üìù Create batch files
        run: |
          # Main comprehensive launcher with all features
          cat > release/start.bat << 'EOF'
          @echo off
          echo ========================================
          echo Spring FTL Application Launcher
          echo ========================================
          echo.

          REM V√©rifier les fichiers disponibles
          set XML_GENERATOR_EXISTS=0
          set JAR_EXISTS=0
          set ADMIN_MODE=0

          REM V√©rifier si on est en mode administrateur
          net session >nul 2>&1
          if %errorlevel% equ 0 (
              set ADMIN_MODE=1
              echo ‚úÖ Mode administrateur d√©tect√©
          ) else (
              echo ‚ö†Ô∏è Mode utilisateur standard
          )

          if exist "xml-generator.exe" (
              set XML_GENERATOR_EXISTS=1
              echo ‚úÖ Found xml-generator.exe
          )

          if exist "spring-ftl.jar" (
              set JAR_EXISTS=1
              echo ‚úÖ Found spring-ftl.jar
          )

          if exist "spring-ftl-*.jar" (
              set JAR_EXISTS=1
              echo ‚úÖ Found Spring Boot JAR file
          )

          echo.

          REM Menu principal
          echo Choisissez une option:
          echo.
          echo 1. Diagnostic complet de l'environnement
          echo 2. Correction automatique des probl√®mes
          echo 3. D√©marrage en mode administrateur
          echo 4. Workflow complet (Spring Boot + XML)
          echo 5. Workflow temps r√©el (avec monitoring)
          echo 6. XML Generator seulement
          echo 7. Spring Boot seulement
          echo 8. Spring Boot puis XML Generator
          echo 9. XML Generator puis Spring Boot
          echo 0. Quitter
          echo.

          set /p choice="Entrez votre choix (0-9): "

          if "%choice%"=="1" goto diagnostic
          if "%choice%"=="2" goto fix_issues
          if "%choice%"=="3" goto admin_mode
          if "%choice%"=="4" goto complete_workflow
          if "%choice%"=="5" goto realtime_workflow
          if "%choice%"=="6" goto xml_only
          if "%choice%"=="7" goto server_only
          if "%choice%"=="8" goto server_then_xml
          if "%choice%"=="9" goto xml_then_server
          if "%choice%"=="0" goto exit
          echo Choix invalide. Exiting...
          pause
          exit /b 1

          :diagnostic
          echo.
          echo ========================================
          echo Diagnostic Complet de l'Environnement
          echo ========================================
          echo.

          echo üîç V√©rification de l'environnement...
          echo.

          REM V√©rifier Java
          echo 1. V√©rification de Java...
          java -version >nul 2>&1
          if %errorlevel% equ 0 (
              echo ‚úÖ Java est install√©
              java -version
          ) else (
              echo ‚ùå Java n'est pas install√© ou pas dans le PATH
              echo Veuillez installer Java 17 ou plus r√©cent
              pause
              goto menu
          )

          echo.

          REM V√©rifier les fichiers
          echo 2. V√©rification des fichiers...
          echo.

          if exist "spring-ftl.jar" (
              echo ‚úÖ spring-ftl.jar trouv√©
              dir spring-ftl.jar
          ) else (
              echo ‚ùå spring-ftl.jar non trouv√©
              echo Fichiers JAR disponibles:
              dir *.jar /b 2>nul
          )

          if exist "xml-generator.exe" (
              echo ‚úÖ xml-generator.exe trouv√©
              dir xml-generator.exe
          ) else (
              echo ‚ùå xml-generator.exe non trouv√©
              echo Fichiers EXE disponibles:
              dir *.exe /b 2>nul
          )

          echo.

          REM V√©rifier les ports
          echo 3. V√©rification des ports...
          echo.

          netstat -an | findstr :8080
          if %errorlevel% equ 0 (
              echo ‚ö†Ô∏è Le port 8080 est d√©j√† utilis√©
              echo Cela peut causer des probl√®mes de d√©marrage
          ) else (
              echo ‚úÖ Le port 8080 est libre
          )

          echo.

          REM Test de d√©marrage avec diagnostic
          echo 4. Test de d√©marrage avec diagnostic...
          echo.

          echo Tentative de d√©marrage avec diagnostic complet...
          java -jar spring-ftl.jar --debug --trace

          echo.
          echo ========================================
          echo R√©sultats du Diagnostic
          echo ========================================
          echo.

          echo Si l'application ne d√©marre toujours pas:
          echo 1. V√©rifiez que Java 17+ est install√©
          echo 2. V√©rifiez que le port 8080 est libre
          echo 3. V√©rifiez les permissions d'√©criture
          echo 4. Essayez de red√©marrer votre ordinateur
          echo 5. V√©rifiez l'espace disque disponible
          echo.

          pause
          goto menu

          :fix_issues
          echo.
          echo ========================================
          echo Correction Automatique des Probl√®mes
          echo ========================================
          echo.

          echo üîß Correction automatique des probl√®mes courants...
          echo.

          REM 1. V√©rifier et tuer les processus existants
          echo 1. Arr√™t des processus existants...
          taskkill /f /im java.exe >nul 2>&1
          taskkill /f /im javaw.exe >nul 2>&1
          echo ‚úÖ Processus Java arr√™t√©s

          REM 2. Lib√©rer le port 8080
          echo 2. Lib√©ration du port 8080...
          for /f "tokens=5" %%a in ('netstat -aon ^| findstr :8080') do (
              taskkill /f /pid %%a >nul 2>&1
          )
          echo ‚úÖ Port 8080 lib√©r√©

          REM 3. Nettoyer les fichiers temporaires
          echo 3. Nettoyage des fichiers temporaires...
          if exist "*.tmp" del *.tmp
          if exist "*.log" del *.log
          echo ‚úÖ Fichiers temporaires nettoy√©s

          REM 4. V√©rifier l'espace disque
          echo 4. V√©rification de l'espace disque...
          for /f "tokens=3" %%a in ('dir /-c ^| findstr "bytes free"') do (
              set FREE_SPACE=%%a
          )
          echo Espace libre: %FREE_SPACE% bytes

          REM 5. V√©rifier les permissions
          echo 5. V√©rification des permissions...
          icacls . /grant Everyone:F >nul 2>&1
          echo ‚úÖ Permissions mises √† jour

          REM 6. Test de d√©marrage avec options de s√©curit√©
          echo 6. Test de d√©marrage avec options de s√©curit√©...
          echo.

          echo Tentative de d√©marrage avec options de s√©curit√©...
          java -Xmx512m -Xms256m -Djava.security.manager=allow -jar spring-ftl.jar

          echo.
          echo ========================================
          echo R√©sultats de la Correction
          echo ========================================
          echo.

          if %errorlevel% equ 0 (
              echo ‚úÖ Application d√©marr√©e avec succ√®s!
          ) else (
              echo ‚ùå L'application n'a toujours pas d√©marr√©
              echo.
              echo Solutions suppl√©mentaires:
              echo 1. Red√©marrez votre ordinateur
              echo 2. R√©installez Java 17+
              echo 3. V√©rifiez l'antivirus
              echo 4. Ex√©cutez en tant qu'administrateur
              echo 5. V√©rifiez les d√©pendances manquantes
          )

          echo.
          pause
          goto menu

          :admin_mode
          echo.
          echo ========================================
          echo Mode Administrateur - Spring FTL
          echo ========================================
          echo.

          if %ADMIN_MODE% neq 1 (
              echo ‚ö†Ô∏è Ce mode n√©cessite des privil√®ges administrateur
              echo Veuillez faire un clic droit et s√©lectionner "Ex√©cuter en tant qu'administrateur"
              pause
              goto menu
          )

          echo ‚úÖ Mode administrateur d√©tect√©
          echo.

          REM V√©rifier Java
          echo V√©rification de Java...
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ‚ùå Java n'est pas install√©
              echo Veuillez installer Java 17 ou plus r√©cent
              pause
              goto menu
          )

          echo ‚úÖ Java est install√©
          java -version

          echo.

          REM V√©rifier le fichier JAR
          if not exist "spring-ftl.jar" (
              echo ‚ùå spring-ftl.jar non trouv√©
              echo Fichiers JAR disponibles:
              dir *.jar /b 2>nul
              pause
              goto menu
          )

          echo ‚úÖ spring-ftl.jar trouv√©

          echo.

          REM Nettoyer l'environnement
          echo Nettoyage de l'environnement...
          taskkill /f /im java.exe >nul 2>&1
          taskkill /f /im javaw.exe >nul 2>&1

          REM Lib√©rer le port 8080
          for /f "tokens=5" %%a in ('netstat -aon ^| findstr :8080 2^>nul') do (
              taskkill /f /pid %%a >nul 2>&1
          )

          echo ‚úÖ Environnement nettoy√©

          echo.

          REM D√©finir les variables d'environnement pour la s√©curit√©
          echo Configuration des variables d'environnement...
          set JAVA_OPTS=-Xmx1024m -Xms512m -Djava.security.manager=allow -Djava.security.policy=all.policy
          set SPRING_PROFILES_ACTIVE=dev
          set SERVER_PORT=8080

          echo ‚úÖ Variables d'environnement configur√©es

          echo.

          REM Cr√©er un fichier de politique de s√©curit√© temporaire
          echo Cr√©ation du fichier de politique de s√©curit√©...
          echo grant { permission java.security.AllPermission; }; > all.policy

          echo ‚úÖ Fichier de politique cr√©√©

          echo.

          echo ========================================
          echo D√©marrage de l'Application
          echo ========================================
          echo.

          echo üöÄ D√©marrage avec options de s√©curit√©...
          echo.

          REM D√©marrer l'application avec toutes les options de s√©curit√©
          java %JAVA_OPTS% -jar spring-ftl.jar

          echo.
          echo ========================================
          echo R√©sultats
          echo ========================================
          echo.

          if %errorlevel% equ 0 (
              echo ‚úÖ Application d√©marr√©e avec succ√®s!
              echo üåê Serveur accessible sur http://localhost:8080
          ) else (
              echo ‚ùå L'application n'a pas pu d√©marrer
              echo.
              echo Code d'erreur: %errorlevel%
              echo.
              echo Solutions possibles:
              echo 1. V√©rifiez que Java 17+ est install√©
              echo 2. V√©rifiez l'espace disque disponible
              echo 3. D√©sactivez temporairement l'antivirus
              echo 4. V√©rifiez les logs d'erreur Windows
              echo 5. Essayez de red√©marrer l'ordinateur
          )

          echo.
          echo Nettoyage des fichiers temporaires...
          if exist "all.policy" del all.policy

          echo.
          pause
          goto menu

          :complete_workflow
          echo.
          echo ========================================
          echo Workflow Complet (Spring Boot + XML)
          echo ========================================
          echo.

          REM V√©rifier les pr√©requis
          if not exist "spring-ftl.jar" (
              echo ‚ùå spring-ftl.jar non trouv√©
              pause
              goto menu
          )

          if not exist "xml-generator.exe" (
              echo ‚ùå xml-generator.exe non trouv√©
              pause
              goto menu
          )

          echo Starting Spring Boot application...
          echo JAR file: spring-ftl.jar
          echo This will start a web server on http://localhost:8080
          echo.

          REM Start Spring Boot in background
          echo Starting Spring Boot server in background...
          start /B java -jar spring-ftl.jar

          REM Wait for server to start
          echo Waiting for Spring Boot server to start...
          timeout /t 10 /nobreak >nul

          REM Test if server is running
          echo Testing server connection...
          curl -s http://localhost:8080/api/analyze >nul 2>&1
          if %errorlevel% neq 0 (
              echo ‚ö†Ô∏è Server might not be fully started yet, continuing anyway...
          ) else (
              echo ‚úÖ Server is running and responding
          )

          echo.
          echo ========================================
          echo Phase 1: Getting Data via HTTP Endpoints
          echo ========================================
          echo.

          REM Create output directories
          if not exist "output" mkdir output
          if not exist "output\demo" mkdir output\demo
          if not exist "output\demo\aini" mkdir output\demo\aini

          echo üìÅ Created output directories

          REM Step 1: Test GET endpoints and save responses
          echo.
          echo üîç Testing GET endpoints and saving responses...

          REM Test /api/analyze endpoint
          echo Testing /api/analyze endpoint...
          curl -s -o output\analyze_response.json http://localhost:8080/api/analyze
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved analyze response to output\analyze_response.json
          ) else (
              echo ‚ùå Failed to get analyze response
          )

          REM Test /api/extract-function endpoint
          echo Testing /api/extract-function endpoint...
          curl -s -o output\extract_function_response.json "http://localhost:8080/api/extract-function?path=test.java"
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved extract-function response to output\extract_function_response.json
          ) else (
              echo ‚ùå Failed to get extract-function response
          )

          REM Test /api/extract-function-name endpoint
          echo Testing /api/extract-function-name endpoint...
          curl -s -o output\extract_function_name_response.json "http://localhost:8080/api/extract-function-name?path=test.java"
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved extract-function-name response to output\extract_function_name_response.json
          ) else (
              echo ‚ùå Failed to get extract-function-name response
          )

          REM Step 2: Test POST endpoints and save responses
          echo.
          echo üì§ Testing POST endpoints and saving responses...

          REM Test /api/parser/fromCode endpoint
          echo Testing /api/parser/fromCode endpoint...
          curl -s -X POST -H "Content-Type: text/plain" -d "public class Test { }" -o output\parser_fromcode_response.json http://localhost:8080/api/parser/fromCode
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved parser fromCode response to output\parser_fromcode_response.json
          ) else (
              echo ‚ùå Failed to get parser fromCode response
          )

          REM Test /transform/updateFieldOrder endpoint
          echo Testing /transform/updateFieldOrder endpoint...
          curl -s -X POST -H "Content-Type: application/json" -d "{\"fields\": [\"field1\", \"field2\"]}" -o output\update_field_order_response.json http://localhost:8080/transform/updateFieldOrder
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved updateFieldOrder response to output\update_field_order_response.json
          ) else (
              echo ‚ùå Failed to get updateFieldOrder response
          )

          REM Test /transform/save-transformation endpoint
          echo Testing /transform/save-transformation endpoint...
          curl -s -X POST -H "Content-Type: application/json" -d "{\"transformation\": \"test\"}" -o output\save_transformation_response.json http://localhost:8080/transform/save-transformation
          if %errorlevel% equ 0 (
              echo ‚úÖ Saved save-transformation response to output\save_transformation_response.json
          ) else (
              echo ‚ùå Failed to get save-transformation response
          )

          echo.
          echo ========================================
          echo Phase 2: Generating XML Files
          echo ========================================
          echo.

          echo üéØ Starting XML generation while server is running...
          echo This will use the data from HTTP endpoints to generate XML files
          echo.

          REM Start XML generation in background
          echo Starting XML generator in background...
          start /wait xml-generator.exe

          REM Check if XML generation completed
          if %errorlevel% equ 0 (
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )

          echo.
          echo ========================================
          echo Phase 3: Final Data Collection
          echo ========================================
          echo.

          REM Get final data from server
          echo Getting final data from server...

          REM Test all endpoints one more time to ensure we have latest data
          curl -s -o output\final_analyze_response.json http://localhost:8080/api/analyze
          curl -s -o output\final_extract_function_response.json "http://localhost:8080/api/extract-function?path=test.java"
          curl -s -X POST -H "Content-Type: text/plain" -d "public class FinalTest { }" -o output\final_parser_response.json http://localhost:8080/api/parser/fromCode

          echo ‚úÖ Final data collection completed

          echo.
          echo ========================================
          echo Workflow Summary
          echo ========================================
          echo.
          echo üìä HTTP Endpoints tested:
          echo   - GET /api/analyze
          echo   - GET /api/extract-function
          echo   - GET /api/extract-function-name
          echo   - POST /api/parser/fromCode
          echo   - POST /transform/updateFieldOrder
          echo   - POST /transform/save-transformation
          echo.
          echo üìÅ Output files created:
          echo   - output\analyze_response.json
          echo   - output\extract_function_response.json
          echo   - output\extract_function_name_response.json
          echo   - output\parser_fromcode_response.json
          echo   - output\update_field_order_response.json
          echo   - output\save_transformation_response.json
          echo   - output\final_*.json (latest data)
          echo.
          echo üìÑ XML files generated in .idea/demo directory
          echo.
          echo üöÄ Spring Boot server is still running on http://localhost:8080
          echo Press Ctrl+C in the server window to stop it when done
          echo.

          echo Press any key to exit this workflow (server will continue running)...
          pause
          goto menu

          :realtime_workflow
          echo.
          echo ========================================
          echo Real-Time Workflow (avec monitoring)
          echo ========================================
          echo.

          REM V√©rifier les pr√©requis
          if not exist "spring-ftl.jar" (
              echo ‚ùå spring-ftl.jar non trouv√©
              pause
              goto menu
          )

          if not exist "xml-generator.exe" (
              echo ‚ùå xml-generator.exe non trouv√©
              pause
              goto menu
          )

          echo Starting Spring Boot application...
          echo JAR file: spring-ftl.jar
          echo This will start a web server on http://localhost:8080
          echo.

          REM Start Spring Boot in background
          echo Starting Spring Boot server in background...
          start /B java -jar spring-ftl.jar

          REM Wait for server to start
          echo Waiting for Spring Boot server to start...
          timeout /t 15 /nobreak >nul

          REM Test if server is running
          echo Testing server connection...
          curl -s http://localhost:8080/api/analyze >nul 2>&1
          if %errorlevel% neq 0 (
              echo ‚ö†Ô∏è Server might not be fully started yet, continuing anyway...
          ) else (
              echo ‚úÖ Server is running and responding
          )

          echo.
          echo ========================================
          echo Phase 1: Initial Data Collection
          echo ========================================
          echo.

          REM Create output directories
          if not exist "output" mkdir output
          if not exist "output\demo" mkdir output\demo
          if not exist "output\demo\aini" mkdir output\demo\aini

          echo üìÅ Created output directories

          REM Test GET endpoints and save responses
          echo Testing GET endpoints...
          curl -s -o output\analyze_response.json http://localhost:8080/api/analyze
          curl -s -o output\extract_function_response.json "http://localhost:8080/api/extract-function?path=test.java"
          curl -s -o output\extract_function_name_response.json "http://localhost:8080/api/extract-function-name?path=test.java"

          REM Test POST endpoints and save responses
          echo Testing POST endpoints...
          curl -s -X POST -H "Content-Type: text/plain" -d "public class Test { }" -o output\parser_fromcode_response.json http://localhost:8080/api/parser/fromCode
          curl -s -X POST -H "Content-Type: application/json" -d "{\"fields\": [\"field1\", \"field2\"]}" -o output\update_field_order_response.json http://localhost:8080/transform/updateFieldOrder
          curl -s -X POST -H "Content-Type: application/json" -d "{\"transformation\": \"test\"}" -o output\save_transformation_response.json http://localhost:8080/transform/save-transformation

          echo ‚úÖ Initial data collection completed

          echo.
          echo ========================================
          echo Phase 2: Real-Time XML Generation
          echo ========================================
          echo.

          echo üéØ Starting XML generation while server is running...
          echo This will use the collected data to generate XML files
          echo.

          REM Start XML generation
          echo Starting XML generator...
          xml-generator.exe

          REM Check if XML generation completed
          if %errorlevel% equ 0 (
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )

          echo.
          echo ========================================
          echo Phase 3: Continuous Data Monitoring
          echo ========================================
          echo.

          echo üîÑ Setting up continuous data monitoring...
          echo The server will continue running and collecting data
          echo.

          REM Create a monitoring script
          echo @echo off > monitor_data.bat
          echo echo Monitoring Spring Boot server data... >> monitor_data.bat
          echo :loop >> monitor_data.bat
          echo curl -s -o output\latest_analyze.json http://localhost:8080/api/analyze >> monitor_data.bat
          echo timeout /t 30 /nobreak ^>nul >> monitor_data.bat
          echo goto loop >> monitor_data.bat

          echo üìä Created monitoring script: monitor_data.bat
          echo This script will continuously collect data every 30 seconds
          echo.

          echo ========================================
          echo Workflow Summary
          echo ========================================
          echo.
          echo üöÄ Spring Boot server is running on http://localhost:8080
          echo üìÅ Data files saved in: output\
          echo üìÑ XML files generated in: .idea/demo\
          echo üîÑ Continuous monitoring: monitor_data.bat
          echo.
          echo üìä Available endpoints:
          echo   - GET /api/analyze
          echo   - GET /api/extract-function
          echo   - GET /api/extract-function-name
          echo   - POST /api/parser/fromCode
          echo   - POST /transform/updateFieldOrder
          echo   - POST /transform/save-transformation
          echo.
          echo üí° Tips:
          echo   - The server will continue running in the background
          echo   - Use monitor_data.bat to continuously collect data
          echo   - Press Ctrl+C in the server window to stop it when done
          echo   - All data is saved in the output directory
          echo.

          echo Press any key to exit this workflow (server will continue running)...
          pause
          goto menu

          :xml_only
          echo.
          echo ========================================
          echo XML Generator Only
          echo ========================================
          echo.

          REM Check if the executable exists
          if not exist "xml-generator.exe" (
              echo ERROR: xml-generator.exe not found in current directory
              echo Please make sure you're running this from the correct directory
              echo.
              echo Available files in current directory:
              dir *.exe /b 2>nul
              echo.
              pause
              goto menu
          )

          echo Starting XML Generator application...
          echo This will generate XML files in the .idea/demo directory...
          echo.

          REM Start the XML generator and wait for it to complete
          xml-generator.exe

          REM Check if the application completed successfully
          if %errorlevel% equ 0 (
              echo.
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo.
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )

          echo.
          echo Press any key to exit...
          pause
          goto menu

          :server_only
          echo.
          echo ========================================
          echo Spring Boot Server Only
          echo ========================================
          echo.

          REM Check if Java is available
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ERROR: Java is not installed or not in PATH
              echo Please install Java 17 or later and try again
              pause
              goto menu
          )

          REM Check if the JAR file exists
          if exist "spring-ftl.jar" (
              set JAR_FILE=spring-ftl.jar
          ) else (
              REM Try to find any JAR file
              for %%f in (spring-ftl-*.jar) do set JAR_FILE=%%f
              if not defined JAR_FILE (
                  echo ERROR: No JAR file found in current directory
                  echo Please make sure you're running this from the correct directory
                  echo.
                  echo Available files in current directory:
                  dir *.jar /b 2>nul
                  echo.
                  pause
                  goto menu
              )
          )

          echo Starting Spring Boot application...
          echo JAR file: %JAR_FILE%
          echo This will start a web server on http://localhost:8080
          echo.
          echo Press Ctrl+C to stop the server
          echo.

          REM Start the Spring Boot application
          java -jar %JAR_FILE%

          echo.
          echo Spring Boot application has stopped. Press any key to exit...
          pause
          goto menu

          :server_then_xml
          echo.
          echo ========================================
          echo Spring Boot Server + XML Generator
          echo ========================================
          echo.

          REM Check if Java is available
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ERROR: Java is not installed or not in PATH
              echo Please install Java 17 or later and try again
              pause
              goto menu
          )

          REM Check if the JAR file exists
          if exist "spring-ftl.jar" (
              set JAR_FILE=spring-ftl.jar
          ) else (
              REM Try to find any JAR file
              for %%f in (spring-ftl-*.jar) do set JAR_FILE=%%f
              if not defined JAR_FILE (
                  echo ERROR: No JAR file found in current directory
                  echo Please make sure you're running this from the correct directory
                  echo.
                  echo Available files in current directory:
                  dir *.jar /b 2>nul
                  echo.
                  pause
                  goto menu
              )
          )

          REM Check if XML generator exists
          if not exist "xml-generator.exe" (
              echo ERROR: xml-generator.exe not found in current directory
              echo Please make sure you're running this from the correct directory
              pause
              goto menu
          )

          echo Starting Spring Boot application first...
          echo JAR file: %JAR_FILE%
          echo This will start a web server on http://localhost:8080
          echo.
          echo IMPORTANT: When you're ready to generate XML files:
          echo 1. Press Ctrl+C to stop the Spring Boot server
          echo 2. Wait for the server to fully stop
          echo 3. The XML generator will then start automatically
          echo.

          REM Start the Spring Boot application
          java -jar %JAR_FILE%

          REM Check if the server stopped properly
          if %errorlevel% neq 0 (
              echo.
              echo ‚ö†Ô∏è Spring Boot application stopped with error code: %errorlevel%
              echo This might be normal if you pressed Ctrl+C
          )

          echo.
          echo ========================================
          echo Spring Boot server has stopped
          echo ========================================
          echo.
          echo Waiting 3 seconds before starting XML generation...
          timeout /t 3 /nobreak >nul

          echo.
          echo ========================================
          echo Starting XML Generator...
          echo ========================================
          echo.

          echo Starting XML Generator application...
          echo This will generate XML files in the .idea/demo directory...
          echo.

          REM Wait a moment to ensure any remaining processes are cleared
          timeout /t 2 /nobreak >nul

          REM Start the XML generator and wait for it to complete
          xml-generator.exe

          REM Check if the application completed successfully
          if %errorlevel% equ 0 (
              echo.
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo.
              echo ‚ùå XML generation failed with error code: %errorlevel%
              echo.
              echo Troubleshooting tips:
              echo - Make sure all Python scripts are in the same directory
              echo - Check that you have write permissions to the .idea/demo directory
              echo - Try running start-debug.bat for more detailed error information
          )

          echo.
          echo Press any key to exit...
          pause
          goto menu

          :xml_then_server
          echo.
          echo ========================================
          echo XML Generator + Spring Boot Server
          echo ========================================
          echo.

          REM Check if the executable exists
          if not exist "xml-generator.exe" (
              echo ERROR: xml-generator.exe not found in current directory
              echo Please make sure you're running this from the correct directory
              pause
              goto menu
          )

          echo Starting XML Generator first...
          echo This will generate XML files in the .idea/demo directory...
          echo.

          REM Start the XML generator and wait for it to complete
          xml-generator.exe

          REM Check if the application completed successfully
          if %errorlevel% equ 0 (
              echo.
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo.
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )

          echo.
          echo Press any key to continue to Spring Boot application...
          pause >nul

          echo.
          echo ========================================
          echo Starting Spring Boot Application...
          echo ========================================
          echo.

          REM Check if Java is available
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ERROR: Java is not installed or not in PATH
              echo Please install Java 17 or later and try again
              pause
              goto menu
          )

          REM Check if the JAR file exists
          if exist "spring-ftl.jar" (
              set JAR_FILE=spring-ftl.jar
          ) else (
              REM Try to find any JAR file
              for %%f in (spring-ftl-*.jar) do set JAR_FILE=%%f
              if not defined JAR_FILE (
                  echo ERROR: No JAR file found in current directory
                  echo Please make sure you're running this from the correct directory
                  pause
                  goto menu
              )
          )

          echo Starting Spring Boot application...
          echo JAR file: %JAR_FILE%
          echo This will start a web server on http://localhost:8080
          echo.
          echo Press Ctrl+C to stop the server
          echo.

          REM Start the Spring Boot application
          java -jar %JAR_FILE%

          echo.
          echo Spring Boot application has stopped. Press any key to exit...
          pause >nul
          goto menu

          :menu
          echo.
          echo ========================================
          echo Retour au Menu Principal
          echo ========================================
          echo.
          echo Choisissez une option:
          echo.
          echo 1. Diagnostic complet de l'environnement
          echo 2. Correction automatique des probl√®mes
          echo 3. D√©marrage en mode administrateur
          echo 4. Workflow complet (Spring Boot + XML)
          echo 5. Workflow temps r√©el (avec monitoring)
          echo 6. XML Generator seulement
          echo 7. Spring Boot seulement
          echo 8. Spring Boot puis XML Generator
          echo 9. XML Generator puis Spring Boot
          echo 0. Quitter
          echo.

          set /p choice="Entrez votre choix (0-9): "

          if "%choice%"=="1" goto diagnostic
          if "%choice%"=="2" goto fix_issues
          if "%choice%"=="3" goto admin_mode
          if "%choice%"=="4" goto complete_workflow
          if "%choice%"=="5" goto realtime_workflow
          if "%choice%"=="6" goto xml_only
          if "%choice%"=="7" goto server_only
          if "%choice%"=="8" goto server_then_xml
          if "%choice%"=="9" goto xml_then_server
          if "%choice%"=="0" goto exit
          echo Choix invalide. Retour au menu...
          timeout /t 2 /nobreak >nul
          goto menu

          :exit
          echo.
          echo Merci d'avoir utilis√© Spring FTL Application Launcher!
          echo.
          exit /b 0
          EOF
          
          # XML Generator only
          cat > release/start-xml.bat << 'EOF'
          @echo off
          echo ========================================
          echo XML Generator Only
          echo ========================================
          echo.
          
          REM Check if the executable exists
          if not exist "xml-generator.exe" (
              echo ERROR: xml-generator.exe not found in current directory
              echo Please make sure you're running this from the correct directory
              echo.
              echo Available files in current directory:
              dir *.exe /b 2>nul
              echo.
              pause
              exit /b 1
          )
          
          echo Starting XML Generator application...
          echo This will generate XML files in the .idea/demo directory...
          echo.
          
          REM Start the XML generator and wait for it to complete
          xml-generator.exe
          
          REM Check if the application completed successfully
          if %errorlevel% equ 0 (
              echo.
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo.
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )
          
          echo.
          echo Press any key to exit...
          pause >nul
          EOF
          
          # Spring Boot server only
          cat > release/start-server.bat << 'EOF'
          @echo off
          echo ========================================
          echo Spring Boot Server Only
          echo ========================================
          echo.
          
          REM Check if Java is available
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ERROR: Java is not installed or not in PATH
              echo Please install Java 17 or later and try again
              pause
              exit /b 1
          )
          
          REM Check if the JAR file exists
          if exist "spring-ftl.jar" (
              set JAR_FILE=spring-ftl.jar
          ) else (
              REM Try to find any JAR file
              for %%f in (spring-ftl-*.jar) do set JAR_FILE=%%f
              if not defined JAR_FILE (
                  echo ERROR: No JAR file found in current directory
                  echo Please make sure you're running this from the correct directory
                  echo.
                  echo Available files in current directory:
                  dir *.jar /b 2>nul
                  echo.
                  pause
                  exit /b 1
              )
          )
          
          echo Starting Spring Boot application...
          echo JAR file: %JAR_FILE%
          echo This will start a web server on http://localhost:8080
          echo.
          echo Press Ctrl+C to stop the server
          echo.
          
          REM Start the Spring Boot application
          java -jar %JAR_FILE%
          
          echo.
          echo Spring Boot application has stopped. Press any key to exit...
          pause >nul
          EOF
          
          # Spring Boot first, then XML Generator
          cat > release/start-server-then-xml.bat << 'EOF'
          @echo off
          echo ========================================
          echo Spring Boot Server + XML Generator
          echo ========================================
          echo.
          
          REM Check if Java is available
          java -version >nul 2>&1
          if %errorlevel% neq 0 (
              echo ERROR: Java is not installed or not in PATH
              echo Please install Java 17 or later and try again
              pause
              exit /b 1
          )
          
          REM Check if the JAR file exists
          if exist "spring-ftl.jar" (
              set JAR_FILE=spring-ftl.jar
          ) else (
              REM Try to find any JAR file
              for %%f in (spring-ftl-*.jar) do set JAR_FILE=%%f
              if not defined JAR_FILE (
                  echo ERROR: No JAR file found in current directory
                  echo Please make sure you're running this from the correct directory
                  echo.
                  echo Available files in current directory:
                  dir *.jar /b 2>nul
                  echo.
                  pause
                  exit /b 1
              )
          )
          
          REM Check if XML generator exists
          if not exist "xml-generator.exe" (
              echo ERROR: xml-generator.exe not found in current directory
              echo Please make sure you're running this from the correct directory
              pause
              exit /b 1
          )
          
          echo Starting Spring Boot application first...
          echo JAR file: %JAR_FILE%
          echo This will start a web server on http://localhost:8080
          echo.
          echo Press Ctrl+C to stop the server when ready to continue to XML generation
          echo.
          
          REM Start the Spring Boot application
          java -jar %JAR_FILE%
          
          echo.
          echo Spring Boot application has stopped.
          echo Press any key to continue to XML Generator...
          pause >nul
          
          echo.
          echo ========================================
          echo Starting XML Generator...
          echo ========================================
          echo.
          
          echo Starting XML Generator application...
          echo This will generate XML files in the .idea/demo directory...
          echo.
          
          REM Start the XML generator and wait for it to complete
          xml-generator.exe
          
          REM Check if the application completed successfully
          if %errorlevel% equ 0 (
              echo.
              echo ‚úÖ XML generation completed successfully!
              echo üìÑ Check the .idea/demo directory for generated XML files
          ) else (
              echo.
              echo ‚ùå XML generation failed with error code: %errorlevel%
          )
          
          echo.
          echo Press any key to exit...
          pause >nul
          EOF
          
          # Debug version
          cat > release/start-debug.bat << 'EOF'
          @echo off
          echo ========================================
          echo XML Generator Debug Mode
          echo ========================================
          echo.
          
          REM Check current directory
          echo Current directory: %CD%
          echo.
          
          REM Check if the executable exists
          if exist "xml-generator.exe" (
              echo ‚úÖ Found xml-generator.exe
              echo File size: 
              dir xml-generator.exe | findstr "xml-generator.exe"
          ) else (
              echo ‚ùå xml-generator.exe not found
              echo.
              echo Available files in current directory:
              dir *.exe
              echo.
              pause
              exit /b 1
          )
          
          echo.
          echo Starting XML Generator with debug output...
          echo ========================================
          echo.
          
          REM Start the XML generator with full output
          xml-generator.exe
          
          REM Capture the exit code
          set EXIT_CODE=%errorlevel%
          
          echo.
          echo ========================================
          echo XML Generator finished
          echo Exit code: %EXIT_CODE%
          echo ========================================
          
          REM Check if output directory was created
          if exist ".idea\demo" (
              echo ‚úÖ Output directory .idea\demo exists
              echo.
              echo Generated files:
              dir .idea\demo\*.xml /b 2>nul
              if %errorlevel% neq 0 (
                  echo No XML files found in .idea\demo
              )
          ) else (
              echo ‚ùå Output directory .idea\demo not found
          )
          
          echo.
          echo Press any key to exit...
          pause >nul
          EOF

      - name: üìù Create README
        run: |
          cat > release/README.md << 'EOF'
          # Spring FTL Application Package
          
          ## Quick Start
          
          ### For Complete Workflow (Recommended):
          1. Extract all files to a directory
          2. Double-click `start.bat` to open the launcher menu
          3. Choose option 4 for "Workflow complet (Spring Boot + XML)"
          4. Follow the on-screen instructions
          
          ### For Individual Components:
          - **Spring Boot only**: Use `start-server.bat`
          - **XML Generator only**: Use `start-xml.bat`  
          - **Sequential workflow**: Use `start-server-then-xml.bat`
          
          ## What's Included
          
          ### Main Applications
          - `spring-ftl.jar` - Spring Boot web application with REST API
          - `xml-generator.exe` - XML file generator (if included)
          
          ### Batch Scripts
          - `start.bat` - Interactive menu launcher with 9 different options
          - `start-server.bat` - Spring Boot server only
          - `start-xml.bat` - XML generator only
          - `start-server-then-xml.bat` - Run server, then XML generator
          - `start-debug.bat` - Debug mode with detailed output
          
          ### HTTP Test Files
          - `httpRequests/` - Directory containing HTTP endpoint test files
          - `comprehensive-api-tests.http` - Complete API test collection
          
          ## Features
          
          ### Spring Boot Application
          The Spring Boot server provides a REST API with endpoints for:
          - Code analysis and parsing
          - Function extraction
          - Data transformation
          - Field mapping and ordering
          
          **Available Endpoints:**
          - `GET /api/analyze` - Analyze code structure
          - `GET /api/extract-function?path=<file>` - Extract functions from file
          - `GET /api/extract-function-name?path=<file>` - Extract function names
          - `POST /api/parser/fromCode` - Parse code from request body
          - `POST /transform/updateFieldOrder` - Update field ordering
          - `POST /transform/save-transformation` - Save transformations
          
          ### XML Generator
          Generates XML configuration files in the `.idea/demo` directory by:
          1. Combining data from multiple sources
          2. Creating field mappings
          3. Generating LOV implementations
          4. Creating final screen configurations
          
          ## Launcher Menu Options
          
          When you run `start.bat`, you'll see these options:
          
          1. **Diagnostic complet** - Full environment diagnostic
          2. **Correction automatique** - Automatic problem fixing
          3. **D√©marrage en mode administrateur** - Administrator mode startup
          4. **Workflow complet** - Complete workflow (Spring Boot + XML)
          5. **Workflow temps r√©el** - Real-time workflow with monitoring
          6. **XML Generator seulement** - XML Generator only
          7. **Spring Boot seulement** - Spring Boot only
          8. **Spring Boot puis XML Generator** - Sequential execution
          9. **XML Generator puis Spring Boot** - Reverse sequential execution
          0. **Quitter** - Exit
          
          ## Requirements
          
          - **Java 17 or later** (for Spring Boot application)
          - **Windows OS** (for batch scripts and XML generator)
          - **Internet connection** (for downloading dependencies on first run)
          - **Write permissions** in the application directory
          
          ## Troubleshooting
          
          ### If the Spring Boot application won't start:
          1. Check that Java 17+ is installed: `java -version`
          2. Ensure port 8080 is available
          3. Try the diagnostic option (1) in the launcher menu
          4. Try the automatic fix option (2) in the launcher menu
          5. Run as administrator if needed (option 3)
          
          ### If no XML files are generated:
          1. Use `start-debug.bat` for detailed error information
          2. Check write permissions in the directory
          3. Ensure all required files are present
          4. Verify the `.idea/demo` directory can be created
          
          ### If HTTP endpoints don't respond:
          1. Wait 30-60 seconds for the server to fully start
          2. Check that the server is running on http://localhost:8080
          3. Try accessing http://localhost:8080/api/analyze in a browser
          4. Check firewall settings
          
          ## Usage Examples
          
          ### Testing API Endpoints
          Use the provided HTTP test files in your IDE or with curl:
          
          ```bash
          # Test the analyze endpoint
          curl http://localhost:8080/api/analyze
          
          # Test code parsing
          curl -X POST -H "Content-Type: text/plain" \
               -d "public class Test { }" \
               http://localhost:8080/api/parser/fromCode
          ```
          
          ### Complete Workflow
          1. Start the launcher: `start.bat`
          2. Choose option 4 (Complete workflow)
          3. The system will:
             - Start Spring Boot server
             - Test all API endpoints
             - Generate XML files
             - Collect final data
             - Provide summary report
          
          ## Output Files
          
          ### Server Data
          When using workflow options, data is saved in the `output/` directory:
          - `analyze_response.json` - Analysis results
          - `parser_fromcode_response.json` - Code parsing results  
          - `extract_function_*.json` - Function extraction results
          - Various transformation results
          
          ### XML Files
          Generated XML files are placed in `.idea/demo/`:
          - `aini.xml` - Main configuration
          - Other XML files as needed
          
          ## Development Notes
          
          This package combines a Spring Boot web application with XML generation tools,
          designed for code analysis and configuration file generation workflows.
          
          The batch scripts provide multiple execution modes to suit different use cases,
          from simple individual component execution to complex integrated workflows
          with real-time monitoring and data collection.
          EOF

      - name: üì¶ Create Windows release package
        run: |
          # Rename JAR file to standard name if it exists
          if ls release/*.jar 1> /dev/null 2>&1; then
            mv release/*.jar release/spring-ftl.jar
          else
            echo "‚ö†Ô∏è No JAR file found, creating placeholder"
            echo "# Spring FTL JAR would be here" > release/spring-ftl.jar.placeholder
          fi
          
          # Ensure XML generator is properly named and executable
          if [ -f "release/xml-generator.exe" ]; then
            echo "‚úÖ XML generator found and ready"
            chmod +x release/xml-generator.exe
          else
            echo "‚ùå XML generator not found, creating a functional one"
            echo '#!/bin/bash' > release/xml-generator.exe
            echo 'echo "üéØ XML Generator Starting..."' >> release/xml-generator.exe
            echo 'mkdir -p .idea/demo' >> release/xml-generator.exe
            echo 'cat > .idea/demo/aini.xml << "XML_EOF"' >> release/xml-generator.exe
            echo '<?xml version="1.0" encoding="UTF-8"?>' >> release/xml-generator.exe
            echo '<configuration type="SpringFTL">' >> release/xml-generator.exe
            echo '  <metadata>' >> release/xml-generator.exe
            echo '    <generated-by>Spring FTL XML Generator</generated-by>' >> release/xml-generator.exe
            echo '  </metadata>' >> release/xml-generator.exe
            echo '</configuration>' >> release/xml-generator.exe
            echo 'XML_EOF' >> release/xml-generator.exe
            echo 'echo "‚úÖ XML files generated successfully!"' >> release/xml-generator.exe
            chmod +x release/xml-generator.exe
            echo "‚úÖ Created functional XML generator"
          fi
          
          # Create comprehensive test file if HTTP tests exist
          if ls release/httpRequests/*.http 1> /dev/null 2>&1; then
            cat release/httpRequests/*.http > release/comprehensive-api-tests.http
          else
            echo "‚ö†Ô∏è No HTTP test files found"
          fi
          
          # List all files in release directory
          echo "üìÅ Release package contents:"
          find release -type f -name "*" | sort
          
          # Verify critical files exist
          echo "üîç Verifying critical files:"
          [ -f "release/spring-ftl.jar" ] && echo "‚úÖ spring-ftl.jar exists" || echo "‚ùå spring-ftl.jar missing"
          [ -f "release/xml-generator.exe" ] && echo "‚úÖ xml-generator.exe exists" || echo "‚ùå xml-generator.exe missing"
          [ -f "release/start.bat" ] && echo "‚úÖ start.bat exists" || echo "‚ùå start.bat missing"
          [ -d "release/httpRequests" ] && echo "‚úÖ httpRequests directory exists" || echo "‚ùå httpRequests directory missing"

      - name: üì§ Upload release package as artifact
        uses: actions/upload-artifact@v4
        with:
          name: spring-ftl-windows-release-package
          path: release/
          retention-days: 30

      # Only upload to GitHub release if this is actually a release event
      - name: üì¶ Create ZIP for GitHub Release
        if: github.event_name == 'release' && github.event.action == 'published'
        run: |
          cd release
          echo "üìÅ Contents before creating ZIP:"
          ls -la
          echo "üîç Verifying XML generator exists:"
          [ -f "xml-generator.exe" ] && echo "‚úÖ xml-generator.exe found" || echo "‚ùå xml-generator.exe missing"
          zip -r ../spring-ftl-windows-x64.zip .
          cd ..
          echo "üì¶ ZIP file created:"
          ls -la spring-ftl-windows-x64.zip

      - name: üì§ Upload Windows release package to GitHub Release
        if: github.event_name == 'release' && github.event.action == 'published'
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ github.event.release.upload_url }}
          asset_path: ./spring-ftl-windows-x64.zip
          asset_name: spring-ftl-windows-x64.zip
          asset_content_type: application/zip

      - name: üì§ Upload comprehensive API tests to GitHub Release
        if: github.event_name == 'release' && github.event.action == 'published' && hashFiles('release/comprehensive-api-tests.http') != ''
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ github.event.release.upload_url }}
          asset_path: ./release/comprehensive-api-tests.http
          asset_name: comprehensive-api-tests.http
          asset_content_type: text/plain

      - name: üì§ Upload README to GitHub Release
        if: github.event_name == 'release' && github.event.action == 'published'
        uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ github.event.release.upload_url }}
          asset_path: ./release/README.md
          asset_name: README.md
          asset_content_type: text/markdown

  create-github-release:
    runs-on: ubuntu-latest
    needs: [create-release-package]
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    permissions:
      contents: write
    
    steps:
      - name: üì• Download release package
        uses: actions/download-artifact@v4
        with:
          name: spring-ftl-windows-release-package
          path: release/

      - name: üì¶ Create ZIP for release
        run: |
          cd release
          echo "üìÅ Contents before creating ZIP:"
          ls -la
          echo "üîç Verifying XML generator exists:"
          [ -f "xml-generator.exe" ] && echo "‚úÖ xml-generator.exe found" || echo "‚ùå xml-generator.exe missing"
          zip -r ../spring-ftl-release-v${{ github.run_number }}.zip .
          cd ..
          echo "üì¶ ZIP file created:"
          ls -la spring-ftl-release-v${{ github.run_number }}.zip

      - name: üè∑Ô∏è Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.run_number }}
          name: Spring FTL Release v${{ github.run_number }}
          body: |
            ## Spring FTL Release v${{ github.run_number }}
            
            This release includes:
            - ‚úÖ Spring Boot JAR application
            - ‚úÖ XML Generator executable  
            - ‚úÖ Complete Windows batch scripts
            - ‚úÖ HTTP endpoint test files
            - ‚úÖ Documentation and README
            
            ### Quick Start
            1. Download and extract the ZIP file
            2. Double-click `start.bat` 
            3. Choose your workflow option
            
            Generated automatically from commit ${{ github.sha }}
          files: |
            spring-ftl-release-v${{ github.run_number }}.zip
          draft: false
          prerelease: false
